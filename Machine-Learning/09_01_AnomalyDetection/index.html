<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><title>(Week9) 01 Anomaly Detection | Louie&#39;s Blog</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Louie's Blog">
    <meta name="author" content="黄刘胤,Louie">
    <meta name="description" content="黄刘胤的博客 Louie's blog" />
    <meta name="keywords" content="黄刘胤,Louie,LouieHuang" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/logo.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="Louie&#39;s Blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
	
    <link rel="stylesheet" href="/highlightjs/xcode.css" type="text/css">
    
    

    <!-- Custom stylesheet, (add custom styles here, always load last) -->
    <!-- Load our stylesheet for IE8 -->
    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- Google Webfonts (Monserrat 400/700, Open Sans 400/600) -->
    <!--     
    <link href='//fonts.useso.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='//fonts.useso.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>
    -->
    <!-- 改为云存储 -->
    <!-- <link href='//gitimage-10031767.file.myqcloud.com/blog_image/Theme_Image/family%3DOpen%2BSans400%2C600.css' rel='stylesheet' type='text/css'> -->
    <!-- 或者本地也可以 -->
    <link href='/css/family=Open+Sans400,600.css' rel='stylesheet' type='text/css'>


    <!-- Load our fonts individually if IE8+, to avoid faux bold & italic rendering -->
    <!--[if IE]>
    <link href='http://fonts.useso.com/css?family=Montserrat:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Montserrat:700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:600' rel='stylesheet' type='text/css'>
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->










  
  
  <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="atom.xml">
  
  

  <!-- Baidu -->
  <!--
  
  -->

  <!-- google统计 -->
  
  <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-76175499-1', 'auto');
  ga('send', 'pageview');
  </script>
  

  
  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>



<body id="index" class="lightnav animsition">

      <!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- header -->
        <div style="text-align:center;margin-top:15px;margin-bottom:-30px;">
            <img style="height:120px;weight:120px" src="/img/header.jpg" alt="Close"/>
            <h4 style="margin-top:10px;color:#fff;">黄刘胤 | Louie</h4>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/Algorithm/" class="animsition-link">Algorithm<small>(7)</small></a></li>
				    
				    <li><a href="/categories/Algorithm-Practice/" class="animsition-link">Algorithm Practice<small>(19)</small></a></li>
				    
				    <li><a href="/categories/Dynamic-Programming/" class="animsition-link">Dynamic Programming<small>(8)</small></a></li>
				    
				    <li><a href="/categories/Information-Retrieval/" class="animsition-link">Information Retrieval<small>(9)</small></a></li>
				    
				    <li><a href="/categories/Machine-Learning/" class="animsition-link">Machine Learning<small>(23)</small></a></li>
				    
				    <li><a href="/categories/Miscellaneous/" class="animsition-link">Miscellaneous<small>(9)</small></a></li>
				    
				    <li><a href="/categories/Project-Images/" class="animsition-link">Project Images<small>(9)</small></a></li>
				    
				    <li><a href="/categories/Recommender-System/" class="animsition-link">Recommender System<small>(8)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="/Resume.pdf" class="animsition-link">Resume</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About Me</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.ico" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">Louie's Blog</a></li>
                            <li class="nolink"><span>Always </span>Thinking</li>
                            
                            <li><a href="https://github.com/louiehuang" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="http://weibo.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->

      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2018-04-12T07:00:00.000Z" itemprop="datePublished">
          2018-04-12
      </time>
    
</span>
                <h1>(Week9) 01 Anomaly Detection</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<h2 id="Anomaly-Detection"><a href="#Anomaly-Detection" class="headerlink" title="Anomaly Detection"></a>Anomaly Detection</h2><p>Materials are from <a href="https://www.coursera.org/learn/machine-learning/resources/szFCa" target="_blank" rel="external">Coursera Machine Learning by Andrew Ng</a>. </p>
<h3 id="1-Density-Estimation"><a href="#1-Density-Estimation" class="headerlink" title="1. Density Estimation"></a>1. Density Estimation</h3><h4 id="1-1-Problem-Motivation"><a href="#1-1-Problem-Motivation" class="headerlink" title="1.1 Problem Motivation"></a>1.1 Problem Motivation</h4><p>Just like in other learning problems, we are given a dataset ${x^{(1)}, x^{(2)},\dots,x^{(m)}}$.</p>
<p>We are then given a new example, $x_{test}$, and we want to know whether this new example is abnormal/anomalous.</p>
<p>We define a “model” p(x) that tells us the probability the example is not anomalous. We also use a threshold $ϵ$ (epsilon) as a dividing line so we can say which examples are anomalous and which are not.</p>
<p>A very common application of anomaly detection is detecting fraud:</p>
<ul>
<li>$x^{(i)}$= features of user i’s activities</li>
<li>Model p(x) from the data.</li>
<li>Identify unusual users by checking which have $p(x)&lt;ϵ$.</li>
</ul>
<p>If our anomaly detector is flagging <strong>too many</strong> anomalous examples, then we need to <strong>decrease</strong> our threshold $ϵ$</p>
<p><br></p>
<h4 id="1-2-Gaussian-Distribution"><a href="#1-2-Gaussian-Distribution" class="headerlink" title="1.2 Gaussian Distribution"></a>1.2 Gaussian Distribution</h4><p>The Gaussian Distribution is a familiar bell-shaped curve that can be described by a function ($μ$, $σ^2$)</p>
<p>Let $x∈ℝ$. If the probability distribution of x is Gaussian with mean $μ$, variance $σ^2$, then:</p>
<script type="math/tex; mode=display">x \sim \mathcal{N}(\mu, \sigma^2)</script><p>The little $\sim$ or ‘tilde’ can be read as “distributed as.”</p>
<p>The Gaussian Distribution is parameterized by a mean and a variance.</p>
<p>Mu, or $μ$, describes the <strong>center</strong> of the curve, called the mean. The <strong>width</strong> of the curve is described by sigma, or $σ$, called the standard deviation.</p>
<p>The full function is as follows:</p>
<script type="math/tex; mode=display">\large p(x;\mu,\sigma^2) = \dfrac{1}{\sigma\sqrt{(2\pi)}}e^{-\dfrac{1}{2}(\dfrac{x - \mu}{\sigma})^2}</script><p>We can estimate the parameter $μ$ from a given dataset by simply taking the average of all the examples:</p>
<script type="math/tex; mode=display">\mu = \dfrac{1}{m}\displaystyle \sum_{i=1}^m x^{(i)}</script><p>We can estimate the other parameter, $σ^2$, with our familiar squared error formula:</p>
<script type="math/tex; mode=display">\sigma^2 = \dfrac{1}{m}\displaystyle \sum_{i=1}^m(x^{(i)} - \mu)^2</script><h4 id="1-3-PCA-Algorithm"><a href="#1-3-PCA-Algorithm" class="headerlink" title="1.3 PCA Algorithm"></a>1.3 PCA Algorithm</h4><p>Given a training set of examples, $\lbrace x^{(1)},\dots,x^{(m)}\rbrace$ where each example is a vector, $x \in \mathbb{R}^n$.</p>
<script type="math/tex; mode=display">p(x) = p(x_1;\mu_1,\sigma_1^2)p(x_2;\mu_2,\sigma^2_2)\cdots p(x_n;\mu_n,\sigma^2_n)</script><p>In statistics, this is called an “independence assumption” on the values of the features inside training example $x$.</p>
<p>More compactly, the above expression can be written as follows:</p>
<script type="math/tex; mode=display">p(x)= \displaystyle \prod^n_{j=1} p(x_j;\mu_j,\sigma_j^2)</script><p><strong>The algorithm</strong></p>
<p>Choose features $x_i$ that you think might be indicative of anomalous examples.</p>
<p>Fit parameters $\mu_1,\dots,\mu_n,\sigma_1^2,\dots,\sigma_n^2$</p>
<p>Calculate $\mu<em>j = \dfrac{1}{m}\displaystyle \sum</em>{i=1}^m x_j^{(i)}$</p>
<p>Calculate $\sigma^2<em>j = \dfrac{1}{m}\displaystyle \sum</em>{i=1}^m(x_j^{(i)} - \mu_j)^2$</p>
<p>Given a new example $x$, compute $p(x)$:</p>
<script type="math/tex; mode=display">p(x) = \displaystyle \prod^n_{j=1} p(x_j;\mu_j,\sigma_j^2) = \prod\limits^n_{j=1} \dfrac{1}{\sqrt{2\pi}\sigma_j}exp(-\dfrac{(x_j - \mu_j)^2}{2\sigma^2_j})</script><p>Anomaly if $p(x)&lt;ϵ$</p>
<p>A vectorized version of the calculation for $μ$ is $\mu = \dfrac{1}{m}\displaystyle \sum_{i=1}^m x^{(i)}$. You can vectorize $σ^2$ similarly.</p>
<p><br></p>
<h3 id="2-Building-an-Anomaly-Detection-System"><a href="#2-Building-an-Anomaly-Detection-System" class="headerlink" title="2. Building an Anomaly Detection System"></a>2. Building an Anomaly Detection System</h3><h4 id="2-1-Developing-and-Evaluating-an-Anomaly-Detection-System"><a href="#2-1-Developing-and-Evaluating-an-Anomaly-Detection-System" class="headerlink" title="2.1 Developing and Evaluating an Anomaly Detection System"></a>2.1 Developing and Evaluating an Anomaly Detection System</h4><p>To evaluate our learning algorithm, we take some labeled data, categorized into anomalous and non-anomalous examples ( y = 0 if normal, y = 1 if anomalous).</p>
<p>Among that data, take a large proportion of <strong>good</strong>, non-anomalous data for the training set on which to train p(x).</p>
<p>Then, take a smaller proportion of mixed anomalous and non-anomalous examples (you will usually have many more non-anomalous examples) for your cross-validation and test sets.</p>
<p>For example, we may have a set where 0.2% of the data is anomalous. </p>
<p>(1) Take 60% of those examples, all of which are good (y=0) for the training set.<br>(2) Take 20% of the examples for the cross-validation set (with 0.1% of the anomalous examples)<br>(3) And another 20% from the test set (with another 0.1% of the anomalous).</p>
<p>In other words, we split the data 60/20/20 training/CV/test and then split the anomalous examples 50/50 between the CV and test sets.</p>
<p><strong>Algorithm evaluation:</strong></p>
<p>Fit model p(x) on training set $\lbrace x^{(1)},\dots,x^{(m)} \rbrace$</p>
<p>On a cross validation/test example x, predict:</p>
<ul>
<li>If $p(x) &lt; ϵ$ (<strong>anomaly</strong>), then y=1</li>
<li>If $p(x) ≥ ϵ$ (<strong>normal</strong>), then y=0</li>
</ul>
<p>Possible evaluation metrics (see “Machine Learning System Design” section):</p>
<ul>
<li>True positive, false positive, false negative, true negative.</li>
<li>Precision/recall</li>
<li>F1 score</li>
</ul>
<p>Note that we use the cross-validation set to choose parameter $ϵ$</p>
<p><strong>Skewed Data:</strong> Samples contain very few negative example, so use F1 score to evaluate may be better. (If you just predict everything as positive, if you get very high accuracy, but this is meaningless)</p>
<h4 id="2-2-Anomaly-Detection-vs-Supervised-Learning"><a href="#2-2-Anomaly-Detection-vs-Supervised-Learning" class="headerlink" title="2.2 Anomaly Detection vs. Supervised Learning"></a>2.2 Anomaly Detection vs. Supervised Learning</h4><p>Anomaly detection looks like supervised learning. When do we use anomaly detection and when do we use supervised learning?</p>
<p><strong>(a) Use Anomaly Detection when:</strong></p>
<blockquote>
<ol>
<li>Very small number of <strong>positive examples (y=1, Anomaly).</strong> (0-20 is common) <strong>and</strong> a large number of <strong>negative (y=0, Normal)</strong> examples.</li>
<li>Many different “types” of anomalies. Hard for any algorithm to learn from posi-ve examples what the anomalies look like; future anomalies may look nothing like any of the anomalous examples we’ve seen so far.</li>
</ol>
</blockquote>
<p><strong>Examples:</strong></p>
<ul>
<li>Fraud detection (If we have enough positive examples, we can use supervised learning for this one)</li>
<li>Manufacturing (e.g. aircraft engines)</li>
<li>Monitoring machines in a data center</li>
</ul>
<p><strong>(b) Use Supervised Learning when:</strong></p>
<blockquote>
<ol>
<li>Large number of positive <strong>and</strong> negative examples.</li>
<li>Enough positive examples for algorithm to get a sense of what positive examples are like. The future positive examples are likely to be similar to ones in training set.</li>
</ol>
</blockquote>
<p><strong>Examples:</strong></p>
<ul>
<li>Email spam classification (we could have enough smaples for each kind of spams)</li>
<li>Weather prediction (sunny/ rainy/etc) </li>
<li>Cancer classification  </li>
</ul>
<h4 id="2-3-Choosing-What-Features-to-Use"><a href="#2-3-Choosing-What-Features-to-Use" class="headerlink" title="2.3 Choosing What Features to Use"></a>2.3 Choosing What Features to Use</h4><p>The features will greatly affect how well your anomaly detection algorithm works.</p>
<p>We can check that our features are <strong>gaussian</strong> by plotting a histogram of our data and checking for the bell-shaped curve.</p>
<p>Some <strong>transforms</strong> we can try on an example feature x that does not have the bell-shaped curve are:</p>
<ul>
<li>log(x)</li>
<li>log(x+1)</li>
<li>log(x+c) for some constant</li>
<li>x√</li>
<li>x1/3</li>
</ul>
<p>We can play with each of these to try and achieve the gaussian shape in our data.</p>
<p>There is an <strong>error analysis procedure</strong> for anomaly detection that is very similar to the one in supervised learning.</p>
<p>Our goal is for p(x) to be large for normal examples and small for anomalous examples.</p>
<p>One common problem is when p(x) is similar for both types of examples. In this case, you need to examine the anomalous examples that are giving high probability in detail and try to figure out new features that will better distinguish the data.</p>
<p>In general, choose features that might take on unusually large or small values in the event of an anomaly.</p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    
    <a class="pull-right" href="/Machine-Learning/08_01_UnsupervisedLearning/">
        (Week8) 01 Unsupervised Learning →
    </a>
    
</nav>

        <!-- not using this
            <div class="duoshuo">
<div class="ds-thread" data-thread-key="Machine-Learning/09_01_AnomalyDetection/" data-title="(Week9) 01 Anomaly Detection" data-url="http://louie.link/Machine-Learning/09_01_AnomalyDetection/"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"louiehuang"};
(function() {
	var ds = document.createElement('script');
	ds.type = 'text/javascript';ds.async = true;
	ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	ds.charset = 'UTF-8';
	(document.getElementsByTagName('head')[0] 
	 || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
</div>
        -->
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2015<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By 黄刘胤,Louie. All Rights Reserved.
                </p>
                <p>Theme By Kieran</p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/louiehuang" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://weibo.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
        
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };
    
    resizeHero();
    
    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

<!-- post to baidu -->
<!-- not using this
    <script type="text/javascript">
    (function(){
        var bp = document.createElement('script');
        bp.src = '//push.zhanzhang.baidu.com/push.js';
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
    </script>
--><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

</body>
</html>
